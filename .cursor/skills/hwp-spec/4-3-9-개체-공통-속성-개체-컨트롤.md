# 4.3.9. 개체 공통 속성을 포함하는 컨트롤(개체 컨트롤)

extended type의 컨트롤은 32비트 ID가 종류를 나타낸다. 컨트롤 코드가 큰 범주, 컨트롤 ID가 세부 분류. 예: 단 정의 `MAKE_4CHID('c','o','T','d')`. `MAKE_4CHID(a,b,c,d) = (((a)<<24)|((b)<<16)|((c)<<8)|(d))`

**표 67: 개체 공통 속성을 포함하는 컨트롤과 컨트롤ID**

| 표 | 컨트롤 ID | 개체 공통 속성 | 개체 요소 속성 |
|---|---|---|---|
| 1 | (그리기 개체) | MAKE_4CHID('t','b','T','') | ✓ |
| | 선 | MAKE_4CHID('$','r','T','n') | ✓ |
| 2 | 사각형 | MAKE_4CHID('$','r','e','c') | ✓ | ✓ |
| | 타원 | MAKE_4CHID('$','e','l','l') | ✓ | ✓ |
| | 호 | MAKE_4CHID('$','a','r','c') | ✓ | ✓ |
| | 다각형 | MAKE_4CHID('$','p','o','l') | ✓ | ✓ |
| | 곡선 | MAKE_4CHID('$','c','u','r') | ✓ | ✓ |
| 3 | 한글 97 수식 | MAKE_4CHID('e','q','e','d') | ✓ |
| 4 | 그림 | MAKE_4CHID('$','p','i','c') | ✓ | ✓ |
| 5 | OLE | MAKE_4CHID('$','o','l','e') | ✓ | ✓ |
| 6 | 묶음 개체 | MAKE_4CHID('$','c','o','n') | ✓ | ✓ |

**표 68: 개체 공통 속성** — BYTE stream n: 개체 공통 속성(표 69). BYTE stream n2: 캡션 있으면 캡션 리스트(표 71). 전체 가변 n+n2.

**표 69: 개체 공통 속성**

| 자료형 | 길이(바이트) | 설명 |
|---|---|---|
| UINT32 | 4 | ctrl ID |
| UINT32 | 4 | 속성(표 70 참조) |
| HWPUNIT | 4 | 세로 오프셋 |
| HWPUNIT | 4 | 가로 오프셋 |
| HWPUNIT | 4 | width |
| HWPUNIT | 4 | height |
| INT32 | 4 | z-order |
| HWPUNIT16 array[4] | 8 | 4방향 여백 |
| UINT32 | 4 | instance ID |
| INT32 | 4 | 쪽나눔 방지 on(1)/off(0) |
| WORD | 2 | 개체 설명문 글자 길이(len) |
| WCHAR array[len] | 2×len | 개체 설명문 |
| 전체 길이 | 가변 | 46+(2×len) |

---

## 구현 주의사항 (DIFFSPEC) / Implementation Notes (DIFFSPEC)

스펙 문서 표 69에서는 `offset_y`와 `offset_x`가 **HWPUNIT (unsigned)**로 명시되어 있지만, **실제 HWP 파일에서는 SHWPUNIT (signed)로 파싱해야 한다.**

이유:
- 오프셋 값은 기준점보다 위나 왼쪽에 위치할 수 있어 음수 값이 필요하다.
- 예: `0xFFFFF9ED` (u32: 4294964461) = i32: `-835` ≈ -0.116인치

레거시 참고: pyhwp는 SHWPUNIT 사용 및 `# DIFFSPEC` 주석, hwpjs.js는 getUint32 사용(잘못된 구현일 수 있음). 따라서 offset_y, offset_x는 INT32로 읽어 SHWPUNIT으로 변환한다.

## 파싱 주의사항 (Parsing Notes)

`parse_object_common`이 컨트롤 ID **이후** 데이터만 파싱하므로 **최소 40바이트**가 필요하다. 표 69 전체 길이는 컨트롤 ID 포함 `46+(2×len)`이지만, 컨트롤 ID 제외 시 `42+(2×len)`이다.

- 필수 필드(컨트롤 ID 제외): attribute(4)+offset_y(4)+offset_x(4)+width(4)+height(4)+z_order(4)+margin(8)+instance_id(4)+page_divide(4) = **40바이트**
- 선택: description_len(2)+description(2×len)

따라서 40바이트는 유효한 크기(page_divide까지, description 없음). 일부 파일에서는 40바이트만 있을 수 있으며, 42바이트 이상일 때 description이 포함될 수 있다.

**표 70: 개체 공통 속성** — bit 0 글자처럼 취급, bit 2 줄간격 영향, bit 3-4 VertRelTo(paper/page/para), bit 5-7 배열 방식, bit 8-9 HorzRelTo, bit 10-12 Horz 배열, bit 13 본문 영역 제한, bit 14 겹침 허용, bit 15-17 폭 기준, bit 18-19 높이 기준, bit 20 크기 보호, bit 21-23 텍스트 흐름(Square/Tight/Through 등), bit 24-25 좌/우 글 배치, bit 26-28 번호 범주(figure/table/equation).

**표 71: 캡션 리스트** — 문단 리스트 헤더(표 65) + 캡션(표 72) 반복. **표 72: 캡션** — UINT 속성(표 73), HWPUNIT 캡션 폭, HWPUNIT16 간격, HWPUNIT 텍스트 최대 길이. 전체 14. **표 73: 캡션 속성** — bit 0-1 방향(left/right/top/bottom), bit 2 마진 포함 여부.
