# 4.3.1. 문단 헤더

Tag ID: HWPTAG_PARA_HEADER

**표 58: 문단 헤더**

| 자료형 | 길이(바이트) | 설명 |
|---|---|---|
| UINT32 | 4 | text(=chars). `if (nchars & 0x80000000) { nchars &= 0x7fffffff; }` |
| UINT32 | 4 | control mask. (UINT32)(1<<ctrich) 조합. ctrich는 HwpCtrlAPI, Hwp 2.1 CtrlCh 참고 |
| UINT16 | 2 | 문단 모양 아이디 참조값 |
| UINT8 | 1 | 문단 스타일 아이디 참조값 |
| UINT8 | 1 | 단 나누기 종류(표 59 참조) |
| UINT16 | 2 | 글자 모양 정보 수 |
| UINT16 | 2 | range tag 정보 수 |
| UINT16 | 2 | 각 줄에 대한 align에 대한 정보 수 |
| UINT32 | 4 | 문단 Instance ID (unique ID) |
| UINT16 | 2 | 변경추적 병합 문단여부, (5.0.3.2 버전 이상) |
| 전체 길이 | 24 | |

**표 59: 단 나누기 종류**

| 값 | 설명 |
|---|---|
| 0x01 | 구역 나누기 |
| 0x02 | 다단 나누기 |
| 0x04 | 쪽 나누기 |
| 0x08 | 단 나누기 |

---

## 주의 (Warning): column_divide_type과 페이지 구분

`column_divide_type` 속성은 **페이지 구분을 위한 신뢰할 수 있는 지표가 아니다.**

실제 HWP 파일에서 페이지 나누기는 다음 두 경우에 발생할 수 있다.

- **명시적 페이지 나누기**: `column_divide_type`에 Page (0x04)가 포함된 경우
- **암시적 페이지 나누기**: 여러 줄바꿈으로 페이지가 채워져 자동으로 새 페이지가 생성되는 경우. 이 경우 `column_divide_type`이 빈 배열(`[]`)일 수 있어, 페이지 구분을 위해 다른 방법이 필요하다.

따라서 레거시 라이브러리들(ruby-hwp, hwpjs.js)은 `column_divide_type` 대신 **LineSegmentInfo의 `vertical_position` 값**으로 페이지를 구분한다.

1. `vertical_position`이 0으로 리셋되거나 이전 문단의 `vertical_position`보다 작아지면 새 페이지로 간주한다.
2. `vertical_position`이 페이지 콘텐츠 영역 높이를 초과하면 새 페이지로 간주한다.

이 구현도 동일한 방식을 사용한다.

---

## 레벨별 사용 (Usage by Level)

아래 내용은 공식 스펙 문서에 명시되지 않았지만, 실제 HWP 파일과 레거시 구현(libhwp, hwp-rs, pyhwp, hwpjs.js, ruby-hwp)에서 확인된 동작이다.

- **Level 0**: 본문의 문단 헤더 (일반적인 사용)
  - Section의 최상위 레벨에서 나타나며, 문단의 시작을 나타낸다.

- **Level 1 이상**: 컨트롤 헤더 내부의 문단 헤더
  - 각주/미주(`fn  `, `en  `), 머리말/꼬리말(`head`, `foot`) 등의 컨트롤 헤더 내부에 직접 나타날 수 있다.
  - 이 경우 PARA_HEADER는 해당 컨트롤 헤더의 자식 레코드로 처리되며, 컨트롤 헤더 내부의 문단 내용을 나타낸다.

- **SHAPE_COMPONENT 내부**: LIST_HEADER 다음의 PARA_HEADER
  - SHAPE_COMPONENT(개체 요소) 내부에서 LIST_HEADER 다음에 PARA_HEADER가 나타날 수 있다 (글상자 텍스트).
  - 이 경우 PARA_HEADER는 LIST_HEADER의 형제 레코드로 나타나며, LIST_HEADER의 `paragraphs` 필드에 포함되어야 한다.
