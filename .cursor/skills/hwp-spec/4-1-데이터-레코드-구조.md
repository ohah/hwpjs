# 4.1. 데이터 레코드 구조

데이터 레코드는 논리적으로 관련된 데이터를 헤더 정보와 함께 저장하는 방법이다. 레코드 구조를 가진 스트림은 여러 개의 연속된 레코드로 구성된다.

데이터 레코드는 헤더와 데이터로 구성되며, 헤더 정보를 이용하여 전체적인 논리 구조를 만들 수 있다. 레코드 헤더에는 데이터 확장을 위한 정보가 포함되어 있어, 한글 문서의 이전 버전에서도 데이터가 추가된 레코드를 읽을 수 있도록 하여 하위 호환성을 보장한다.

**그림 45: 레코드 구조**

```
레코드
├── 헤더 (DWORD)
│   ├── Tag ID (bits 0-9)
│   ├── Level (bits 10-19)
│   └── Size (bits 20-31)
└── 데이터
```

레코드 헤더의 크기는 32bits이고 TagID(10bits), Level(10bits), Size(12bits)로 구성된다.

**Tag ID:**
- 레코드가 나타내는 데이터의 종류를 나타낸다.
- 10비트를 사용하므로 0x000부터 0x3FF까지의 값을 가질 수 있다.
- 0x000 - 0x00F: 특수 목적으로 사용되며, 일반적인 레코드 태그로 사용되지 않는다.
- 0x010 - 0x1FF: 한글 내부 사용을 위해 예약되어 있다 (HWPTAG_BEGIN = 0x010).
- 0x200 - 0x3FF: 외부 응용 프로그램이 사용할 수 있는 영역이다.

**Level:**
- 대부분의 객체는 여러 개의 레코드로 구성되므로, "논리적으로 관련된 연속된 레코드"라는 개념이 필요하다.
- Level은 이러한 논리적 그룹핑을 나타내는 정보를 제공한다.
- 스트림을 구성하는 모든 레코드는 계층 구조로 표현할 수 있으며, Level은 이 계층 구조에서의 깊이를 나타낸다.

**Size:**
- 데이터 영역의 길이를 바이트 단위로 나타낸다.
- 12비트가 모두 1인 경우(즉, 0xFFF)는 데이터 영역의 길이가 4095바이트 이상임을 나타낸다.
- 이 경우(데이터가 4095바이트를 초과하는 경우) 레코드 헤더 바로 다음에 길이를 나타내는 DWORD가 추가된다.

**그림 46: 확장 데이터 레코드 구조**

```
레코드
├── 헤더 (DWORD)
├── 길이 (DWORD)
└── 데이터
```
